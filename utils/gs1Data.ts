import { CountryPrefix } from '../types';

// Simplified GS1 prefix list
const gs1Prefixes: CountryPrefix[] = [
  { prefix: '000-019', name: 'USA & Canada', code: 'US', flag: 'ðŸ‡ºðŸ‡¸' },
  { prefix: '020-029', name: 'Restricted Distribution', code: 'XX', flag: 'ðŸŒ' },
  { prefix: '030-039', name: 'USA Drugs', code: 'US', flag: 'ðŸ‡ºðŸ‡¸' },
  { prefix: '040-049', name: 'Restricted Distribution', code: 'XX', flag: 'ðŸŒ' },
  { prefix: '050-059', name: 'Coupons', code: 'XX', flag: 'ðŸŽŸï¸' },
  { prefix: '060-139', name: 'USA & Canada', code: 'US', flag: 'ðŸ‡ºðŸ‡¸' },
  { prefix: '200-299', name: 'Restricted Distribution', code: 'XX', flag: 'ðŸŒ' },
  { prefix: '300-379', name: 'France', code: 'FR', flag: 'ðŸ‡«ðŸ‡·' },
  { prefix: '380', name: 'Bulgaria', code: 'BG', flag: 'ðŸ‡§ðŸ‡¬' },
  { prefix: '383', name: 'Slovenia', code: 'SI', flag: 'ðŸ‡¸ðŸ‡®' },
  { prefix: '385', name: 'Croatia', code: 'HR', flag: 'ðŸ‡­ðŸ‡·' },
  { prefix: '387', name: 'Bosnia and Herzegovina', code: 'BA', flag: 'ðŸ‡§ðŸ‡¦' },
  { prefix: '400-440', name: 'Germany', code: 'DE', flag: 'ðŸ‡©ðŸ‡ª' },
  { prefix: '450-459', name: 'Japan', code: 'JP', flag: 'ðŸ‡¯ðŸ‡µ' },
  { prefix: '460-469', name: 'Russia', code: 'RU', flag: 'ðŸ‡·ðŸ‡º' },
  { prefix: '470', name: 'Kyrgyzstan', code: 'KG', flag: 'ðŸ‡°ðŸ‡¬' },
  { prefix: '471', name: 'Taiwan', code: 'TW', flag: 'ðŸ‡¹ðŸ‡¼' },
  { prefix: '474', name: 'Estonia', code: 'EE', flag: 'ðŸ‡ªðŸ‡ª' },
  { prefix: '475', name: 'Latvia', code: 'LV', flag: 'ðŸ‡±ðŸ‡»' },
  { prefix: '476', name: 'Azerbaijan', code: 'AZ', flag: 'ðŸ‡¦ðŸ‡¿' },
  { prefix: '477', name: 'Lithuania', code: 'LT', flag: 'ðŸ‡±ðŸ‡¹' },
  { prefix: '478', name: 'Uzbekistan', code: 'UZ', flag: 'ðŸ‡ºðŸ‡¿' },
  { prefix: '479', name: 'Sri Lanka', code: 'LK', flag: 'ðŸ‡±ðŸ‡°' },
  { prefix: '480', name: 'Philippines', code: 'PH', flag: 'ðŸ‡µðŸ‡­' },
  { prefix: '481', name: 'Belarus', code: 'BY', flag: 'ðŸ‡§ðŸ‡¾' },
  { prefix: '482', name: 'Ukraine', code: 'UA', flag: 'ðŸ‡ºðŸ‡¦' },
  { prefix: '484', name: 'Moldova', code: 'MD', flag: 'ðŸ‡²ðŸ‡©' },
  { prefix: '485', name: 'Armenia', code: 'AM', flag: 'ðŸ‡¦ðŸ‡²' },
  { prefix: '486', name: 'Georgia', code: 'GE', flag: 'ðŸ‡¬ðŸ‡ª' },
  { prefix: '487', name: 'Kazakhstan', code: 'KZ', flag: 'ðŸ‡°ðŸ‡¿' },
  { prefix: '488', name: 'Tajikistan', code: 'TJ', flag: 'ðŸ‡¹ðŸ‡¯' },
  { prefix: '489', name: 'Hong Kong', code: 'HK', flag: 'ðŸ‡­ðŸ‡°' },
  { prefix: '490-499', name: 'Japan', code: 'JP', flag: 'ðŸ‡¯ðŸ‡µ' },
  { prefix: '500-509', name: 'United Kingdom', code: 'GB', flag: 'ðŸ‡¬ðŸ‡§' },
  { prefix: '520-521', name: 'Greece', code: 'GR', flag: 'ðŸ‡¬ðŸ‡·' },
  { prefix: '528', name: 'Lebanon', code: 'LB', flag: 'ðŸ‡±ðŸ‡§' },
  { prefix: '529', name: 'Cyprus', code: 'CY', flag: 'ðŸ‡¨ðŸ‡¾' },
  { prefix: '530', name: 'Albania', code: 'AL', flag: 'ðŸ‡¦ðŸ‡±' },
  { prefix: '531', name: 'North Macedonia', code: 'MK', flag: 'ðŸ‡²ðŸ‡°' },
  { prefix: '535', name: 'Malta', code: 'MT', flag: 'ðŸ‡²ðŸ‡¹' },
  { prefix: '539', name: 'Ireland', code: 'IE', flag: 'ðŸ‡®ðŸ‡ª' },
  { prefix: '540-549', name: 'Belgium & Luxembourg', code: 'BE', flag: 'ðŸ‡§ðŸ‡ª' },
  { prefix: '560', name: 'Portugal', code: 'PT', flag: 'ðŸ‡µðŸ‡¹' },
  { prefix: '569', name: 'Iceland', code: 'IS', flag: 'ðŸ‡®ðŸ‡¸' },
  { prefix: '570-579', name: 'Denmark', code: 'DK', flag: 'ðŸ‡©ðŸ‡°' },
  { prefix: '590', name: 'Poland', code: 'PL', flag: 'ðŸ‡µðŸ‡±' },
  { prefix: '594', name: 'Romania', code: 'RO', flag: 'ðŸ‡·ðŸ‡´' },
  { prefix: '599', name: 'Hungary', code: 'HU', flag: 'ðŸ‡­ðŸ‡º' },
  { prefix: '600-601', name: 'South Africa', code: 'ZA', flag: 'ðŸ‡¿ðŸ‡¦' },
  { prefix: '603', name: 'Ghana', code: 'GH', flag: 'ðŸ‡¬ðŸ‡­' },
  { prefix: '608', name: 'Bahrain', code: 'BH', flag: 'ðŸ‡§ðŸ‡­' },
  { prefix: '609', name: 'Mauritius', code: 'MU', flag: 'ðŸ‡²ðŸ‡º' },
  { prefix: '611', name: 'Morocco', code: 'MA', flag: 'ðŸ‡²ðŸ‡¦' },
  { prefix: '613', name: 'Algeria', code: 'DZ', flag: 'ðŸ‡©ðŸ‡¿' },
  { prefix: '615', name: 'Nigeria', code: 'NG', flag: 'ðŸ‡³ðŸ‡¬' },
  { prefix: '616', name: 'Kenya', code: 'KE', flag: 'ðŸ‡°ðŸ‡ª' },
  { prefix: '618', name: 'Ivory Coast', code: 'CI', flag: 'ðŸ‡¨ðŸ‡®' },
  { prefix: '619', name: 'Tunisia', code: 'TN', flag: 'ðŸ‡¹ðŸ‡³' },
  { prefix: '621', name: 'Syria', code: 'SY', flag: 'ðŸ‡¸ðŸ‡¾' },
  { prefix: '622', name: 'Egypt', code: 'EG', flag: 'ðŸ‡ªðŸ‡¬' },
  { prefix: '624', name: 'Libya', code: 'LY', flag: 'ðŸ‡±ðŸ‡¾' },
  { prefix: '625', name: 'Jordan', code: 'JO', flag: 'ðŸ‡¯ðŸ‡´' },
  { prefix: '626', name: 'Iran', code: 'IR', flag: 'ðŸ‡®ðŸ‡·' },
  { prefix: '627', name: 'Kuwait', code: 'KW', flag: 'ðŸ‡°ðŸ‡¼' },
  { prefix: '628', name: 'Saudi Arabia', code: 'SA', flag: 'ðŸ‡¸ðŸ‡¦' },
  { prefix: '629', name: 'UAE', code: 'AE', flag: 'ðŸ‡¦ðŸ‡ª' },
  { prefix: '640-649', name: 'Finland', code: 'FI', flag: 'ðŸ‡«ðŸ‡®' },
  { prefix: '690-699', name: 'China', code: 'CN', flag: 'ðŸ‡¨ðŸ‡³' },
  { prefix: '700-709', name: 'Norway', code: 'NO', flag: 'ðŸ‡³ðŸ‡´' },
  { prefix: '729', name: 'Israel', code: 'IL', flag: 'ðŸ‡®ðŸ‡±' },
  { prefix: '730-739', name: 'Sweden', code: 'SE', flag: 'ðŸ‡¸ðŸ‡ª' },
  { prefix: '740', name: 'Guatemala', code: 'GT', flag: 'ðŸ‡¬ðŸ‡¹' },
  { prefix: '741', name: 'El Salvador', code: 'SV', flag: 'ðŸ‡¸ðŸ‡»' },
  { prefix: '742', name: 'Honduras', code: 'HN', flag: 'ðŸ‡­ðŸ‡³' },
  { prefix: '743', name: 'Nicaragua', code: 'NI', flag: 'ðŸ‡³ðŸ‡®' },
  { prefix: '744', name: 'Costa Rica', code: 'CR', flag: 'ðŸ‡¨ðŸ‡·' },
  { prefix: '745', name: 'Panama', code: 'PA', flag: 'ðŸ‡µðŸ‡¦' },
  { prefix: '746', name: 'Dominican Republic', code: 'DO', flag: 'ðŸ‡©ðŸ‡´' },
  { prefix: '750', name: 'Mexico', code: 'MX', flag: 'ðŸ‡²ðŸ‡½' },
  { prefix: '754-755', name: 'Canada', code: 'CA', flag: 'ðŸ‡¨ðŸ‡¦' },
  { prefix: '759', name: 'Venezuela', code: 'VE', flag: 'ðŸ‡»ðŸ‡ª' },
  { prefix: '760-769', name: 'Switzerland', code: 'CH', flag: 'ðŸ‡¨ðŸ‡­' },
  { prefix: '770-771', name: 'Colombia', code: 'CO', flag: 'ðŸ‡¨ðŸ‡´' },
  { prefix: '773', name: 'Uruguay', code: 'UY', flag: 'ðŸ‡ºðŸ‡¾' },
  { prefix: '775', name: 'Peru', code: 'PE', flag: 'ðŸ‡µðŸ‡ª' },
  { prefix: '777', name: 'Bolivia', code: 'BO', flag: 'ðŸ‡§ðŸ‡´' },
  { prefix: '779', name: 'Argentina', code: 'AR', flag: 'ðŸ‡¦ðŸ‡·' },
  { prefix: '780', name: 'Chile', code: 'CL', flag: 'ðŸ‡¨ðŸ‡±' },
  { prefix: '784', name: 'Paraguay', code: 'PY', flag: 'ðŸ‡µðŸ‡¾' },
  { prefix: '786', name: 'Ecuador', code: 'EC', flag: 'ðŸ‡ªðŸ‡¨' },
  { prefix: '789-790', name: 'Brazil', code: 'BR', flag: 'ðŸ‡§ðŸ‡·' },
  { prefix: '800-839', name: 'Italy', code: 'IT', flag: 'ðŸ‡®ðŸ‡¹' },
  { prefix: '840-849', name: 'Spain', code: 'ES', flag: 'ðŸ‡ªðŸ‡¸' },
  { prefix: '850', name: 'Cuba', code: 'CU', flag: 'ðŸ‡¨ðŸ‡º' },
  { prefix: '858', name: 'Slovakia', code: 'SK', flag: 'ðŸ‡¸ðŸ‡°' },
  { prefix: '859', name: 'Czech Republic', code: 'CZ', flag: 'ðŸ‡¨ðŸ‡¿' },
  { prefix: '860', name: 'Serbia', code: 'RS', flag: 'ðŸ‡·ðŸ‡¸' },
  { prefix: '865', name: 'Mongolia', code: 'MN', flag: 'ðŸ‡²ðŸ‡³' },
  { prefix: '867', name: 'North Korea', code: 'KP', flag: 'ðŸ‡°ðŸ‡µ' },
  { prefix: '868-869', name: 'Turkey', code: 'TR', flag: 'ðŸ‡¹ðŸ‡·' },
  { prefix: '870-879', name: 'Netherlands', code: 'NL', flag: 'ðŸ‡³ðŸ‡±' },
  { prefix: '880', name: 'South Korea', code: 'KR', flag: 'ðŸ‡°ðŸ‡·' },
  { prefix: '884', name: 'Cambodia', code: 'KH', flag: 'ðŸ‡°ðŸ‡­' },
  { prefix: '885', name: 'Thailand', code: 'TH', flag: 'ðŸ‡¹ðŸ‡­' },
  { prefix: '888', name: 'Singapore', code: 'SG', flag: 'ðŸ‡¸ðŸ‡¬' },
  { prefix: '890', name: 'India', code: 'IN', flag: 'ðŸ‡®ðŸ‡³' },
  { prefix: '893', name: 'Vietnam', code: 'VN', flag: 'ðŸ‡»ðŸ‡³' },
  { prefix: '896', name: 'Pakistan', code: 'PK', flag: 'ðŸ‡µðŸ‡°' },
  { prefix: '899', name: 'Indonesia', code: 'ID', flag: 'ðŸ‡®ðŸ‡©' },
  { prefix: '900-919', name: 'Austria', code: 'AT', flag: 'ðŸ‡¦ðŸ‡¹' },
  { prefix: '930-939', name: 'Australia', code: 'AU', flag: 'ðŸ‡¦ðŸ‡º' },
  { prefix: '940-949', name: 'New Zealand', code: 'NZ', flag: 'ðŸ‡³ðŸ‡¿' },
  { prefix: '955', name: 'Malaysia', code: 'MY', flag: 'ðŸ‡²ðŸ‡¾' },
  { prefix: '958', name: 'Macau', code: 'MO', flag: 'ðŸ‡²ðŸ‡´' },
];

export const getCountryFromBarcode = (barcode: string): CountryPrefix | undefined => {
  // EAN-13 is usually 13 digits. UPC-A is 12 digits (can be treated as 0 + UPC).
  let cleanCode = barcode.replace(/[^0-9]/g, '');
  
  if (cleanCode.length === 12) {
    cleanCode = '0' + cleanCode; // Convert UPC to EAN-13
  }
  
  if (cleanCode.length !== 13) return undefined;

  const prefixVal = parseInt(cleanCode.substring(0, 3));

  return gs1Prefixes.find(p => {
    if (p.prefix.includes('-')) {
      const [start, end] = p.prefix.split('-').map(Number);
      return prefixVal >= start && prefixVal <= end;
    }
    return prefixVal === Number(p.prefix);
  });
};